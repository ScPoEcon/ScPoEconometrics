<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Econometrics with R</title>
  <meta name="description" content="SciencesPo UG Econometrics online textbook. Almost no Maths.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Econometrics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://scpoecon.github.io/ScPoEconometrics/" />
  
  <meta property="og:description" content="SciencesPo UG Econometrics online textbook. Almost no Maths." />
  <meta name="github-repo" content="ScPoEcon/ScPoEconometrics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Econometrics with R" />
  
  <meta name="twitter:description" content="SciencesPo UG Econometrics online textbook. Almost no Maths." />
  

<meta name="author" content="Florian Oswald, Jean-Marc Robin and Vincent Viers">


<meta name="date" content="2018-11-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.gif" type="image/x-icon">
<link rel="prev" href="sum.html">
<link rel="next" href="multiple-reg.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41584331-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-41584331-4');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ScPo 2nd Year Econometrics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Syllabus</a></li>
<li class="chapter" data-level="1" data-path="R-intro.html"><a href="R-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to <code>R</code></a><ul>
<li class="chapter" data-level="1.1" data-path="R-intro.html"><a href="R-intro.html#getting-started"><i class="fa fa-check"></i><b>1.1</b> Getting Started</a></li>
<li class="chapter" data-level="1.2" data-path="R-intro.html"><a href="R-intro.html#starting-r-and-rstudio"><i class="fa fa-check"></i><b>1.2</b> Starting R and RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="R-intro.html"><a href="R-intro.html#basic-calculations"><i class="fa fa-check"></i><b>1.3</b> Basic Calculations</a></li>
<li class="chapter" data-level="1.4" data-path="R-intro.html"><a href="R-intro.html#getting-help"><i class="fa fa-check"></i><b>1.4</b> Getting Help</a></li>
<li class="chapter" data-level="1.5" data-path="R-intro.html"><a href="R-intro.html#installing-packages"><i class="fa fa-check"></i><b>1.5</b> Installing Packages</a></li>
<li class="chapter" data-level="1.6" data-path="R-intro.html"><a href="R-intro.html#code-output"><i class="fa fa-check"></i><b>1.6</b> <code>Code</code> vs Output in this Book</a></li>
<li class="chapter" data-level="1.7" data-path="R-intro.html"><a href="R-intro.html#install-package"><i class="fa fa-check"></i><b>1.7</b> <code>ScPoEconometrics</code> Package</a></li>
<li class="chapter" data-level="1.8" data-path="R-intro.html"><a href="R-intro.html#data-types"><i class="fa fa-check"></i><b>1.8</b> Data Types</a></li>
<li class="chapter" data-level="1.9" data-path="R-intro.html"><a href="R-intro.html#data-structures"><i class="fa fa-check"></i><b>1.9</b> Data Structures</a></li>
<li class="chapter" data-level="1.10" data-path="R-intro.html"><a href="R-intro.html#dataframes"><i class="fa fa-check"></i><b>1.10</b> Data Frames</a></li>
<li class="chapter" data-level="1.11" data-path="R-intro.html"><a href="R-intro.html#programming-basics"><i class="fa fa-check"></i><b>1.11</b> Programming Basics</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sum.html"><a href="sum.html"><i class="fa fa-check"></i><b>2</b> Working With Data</a><ul>
<li class="chapter" data-level="2.1" data-path="sum.html"><a href="sum.html#summary-statistics"><i class="fa fa-check"></i><b>2.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="2.2" data-path="sum.html"><a href="sum.html#plotting"><i class="fa fa-check"></i><b>2.2</b> Plotting</a></li>
<li class="chapter" data-level="2.3" data-path="sum.html"><a href="sum.html#summarize-two"><i class="fa fa-check"></i><b>2.3</b> Summarizing Two Variables</a></li>
<li class="chapter" data-level="2.4" data-path="sum.html"><a href="sum.html#the-tidyverse"><i class="fa fa-check"></i><b>2.4</b> The <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linreg.html"><a href="linreg.html"><i class="fa fa-check"></i><b>3</b> Linear Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="linreg.html"><a href="linreg.html#how-are-x-and-y-related"><i class="fa fa-check"></i><b>3.1</b> How are <code>x</code> and <code>y</code> related?</a></li>
<li class="chapter" data-level="3.2" data-path="linreg.html"><a href="linreg.html#OLS"><i class="fa fa-check"></i><b>3.2</b> Ordinary Least Squares (OLS) Estimator</a></li>
<li class="chapter" data-level="3.3" data-path="linreg.html"><a href="linreg.html#pred-resids"><i class="fa fa-check"></i><b>3.3</b> Predictions and Residuals</a></li>
<li class="chapter" data-level="3.4" data-path="linreg.html"><a href="linreg.html#correlation-covariance-and-linearity"><i class="fa fa-check"></i><b>3.4</b> Correlation, Covariance and Linearity</a></li>
<li class="chapter" data-level="3.5" data-path="linreg.html"><a href="linreg.html#analysing-vary"><i class="fa fa-check"></i><b>3.5</b> Analysing <span class="math inline">\(Var(y)\)</span></a></li>
<li class="chapter" data-level="3.6" data-path="linreg.html"><a href="linreg.html#assessing-the-goodness-of-fit"><i class="fa fa-check"></i><b>3.6</b> Assessing the <em>Goodness of Fit</em></a></li>
<li class="chapter" data-level="3.7" data-path="linreg.html"><a href="linreg.html#lm-example1"><i class="fa fa-check"></i><b>3.7</b> An Example: California Student Test Scores</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multiple-reg.html"><a href="multiple-reg.html"><i class="fa fa-check"></i><b>4</b> Multiple Regression</a><ul>
<li class="chapter" data-level="4.1" data-path="multiple-reg.html"><a href="multiple-reg.html#ceteris"><i class="fa fa-check"></i><b>4.1</b> All Else Equal</a></li>
<li class="chapter" data-level="4.2" data-path="multiple-reg.html"><a href="multiple-reg.html#multicol"><i class="fa fa-check"></i><b>4.2</b> Multicolinearity</a></li>
<li class="chapter" data-level="4.3" data-path="multiple-reg.html"><a href="multiple-reg.html#california-test-scores-2"><i class="fa fa-check"></i><b>4.3</b> California Test Scores 2</a></li>
<li class="chapter" data-level="4.4" data-path="multiple-reg.html"><a href="multiple-reg.html#mreg-interactions"><i class="fa fa-check"></i><b>4.4</b> Interactions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="categorical-vars.html"><a href="categorical-vars.html"><i class="fa fa-check"></i><b>5</b> Categorial Variables</a><ul>
<li class="chapter" data-level="5.1" data-path="categorical-vars.html"><a href="categorical-vars.html#the-binary-regressor-case"><i class="fa fa-check"></i><b>5.1</b> The Binary Regressor Case</a></li>
<li class="chapter" data-level="5.2" data-path="categorical-vars.html"><a href="categorical-vars.html#dummy-and-continuous-variables"><i class="fa fa-check"></i><b>5.2</b> Dummy and Continuous Variables</a></li>
<li class="chapter" data-level="5.3" data-path="categorical-vars.html"><a href="categorical-vars.html#categorical-variables-in-r-factor"><i class="fa fa-check"></i><b>5.3</b> Categorical Variables in <code>R</code>: <code>factor</code></a></li>
<li class="chapter" data-level="5.4" data-path="categorical-vars.html"><a href="categorical-vars.html#saturated-models-main-effects-and-interactions"><i class="fa fa-check"></i><b>5.4</b> Saturated Models: Main Effects and Interactions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="std-errors.html"><a href="std-errors.html"><i class="fa fa-check"></i><b>6</b> Standard Errors</a><ul>
<li class="chapter" data-level="6.1" data-path="std-errors.html"><a href="std-errors.html#what-is-true-what-are-statistical-models"><i class="fa fa-check"></i><b>6.1</b> What is <em>true</em>? What are Statistical Models?</a></li>
<li class="chapter" data-level="6.2" data-path="std-errors.html"><a href="std-errors.html#class-reg"><i class="fa fa-check"></i><b>6.2</b> The Classical Regression Model</a></li>
<li class="chapter" data-level="6.3" data-path="std-errors.html"><a href="std-errors.html#hypothesis-testing"><i class="fa fa-check"></i><b>6.3</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="6.4" data-path="std-errors.html"><a href="std-errors.html#whats-in-my-model-and-what-is-not"><i class="fa fa-check"></i><b>6.4</b> What’s in my model? (And what is not?)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="quantreg.html"><a href="quantreg.html"><i class="fa fa-check"></i><b>7</b> Quantile Regression</a></li>
<li class="chapter" data-level="8" data-path="panel-data.html"><a href="panel-data.html"><i class="fa fa-check"></i><b>8</b> Panel Data</a><ul>
<li class="chapter" data-level="8.1" data-path="panel-data.html"><a href="panel-data.html#fixed-effects"><i class="fa fa-check"></i><b>8.1</b> fixed effects</a></li>
<li class="chapter" data-level="8.2" data-path="panel-data.html"><a href="panel-data.html#did"><i class="fa fa-check"></i><b>8.2</b> DiD</a></li>
<li class="chapter" data-level="8.3" data-path="panel-data.html"><a href="panel-data.html#rdd"><i class="fa fa-check"></i><b>8.3</b> RDD</a></li>
<li class="chapter" data-level="8.4" data-path="panel-data.html"><a href="panel-data.html#example"><i class="fa fa-check"></i><b>8.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="IV.html"><a href="IV.html"><i class="fa fa-check"></i><b>9</b> Instrumental Variables</a><ul>
<li class="chapter" data-level="9.1" data-path="IV.html"><a href="IV.html#simultaneity-bias"><i class="fa fa-check"></i><b>9.1</b> Simultaneity Bias</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logit-probit.html"><a href="logit-probit.html"><i class="fa fa-check"></i><b>10</b> Logit and Probit</a></li>
<li class="chapter" data-level="11" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>11</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="12" data-path="R-advanced.html"><a href="R-advanced.html"><i class="fa fa-check"></i><b>12</b> Advanced <code>R</code></a><ul>
<li class="chapter" data-level="12.1" data-path="R-advanced.html"><a href="R-advanced.html#more-vectorization"><i class="fa fa-check"></i><b>12.1</b> More Vectorization</a></li>
<li class="chapter" data-level="12.2" data-path="R-advanced.html"><a href="R-advanced.html#calculations-with-vectors-and-matrices"><i class="fa fa-check"></i><b>12.2</b> Calculations with Vectors and Matrices</a></li>
<li class="chapter" data-level="12.3" data-path="R-advanced.html"><a href="R-advanced.html#matrices-1"><i class="fa fa-check"></i><b>12.3</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>13</b> Slides</a></li>
<li class="chapter" data-level="14" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>14</b> Notes</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Econometrics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linreg" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Linear Regression</h1>
<p>In this chapter we will learn an additional way how one can represent the relationship between <em>outcome</em>, or <em>dependent</em> variable variable <span class="math inline">\(y\)</span> and an <em>explanatory</em> or <em>independent</em> variable <span class="math inline">\(x\)</span>. We will refer throughout to the graphical representation of a collection of independent observations on <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, i.e., a <em>dataset</em>.</p>
<div id="how-are-x-and-y-related" class="section level2">
<h2><span class="header-section-number">3.1</span> How are <code>x</code> and <code>y</code> related?</h2>
<div id="data-on-cars" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Data on Cars</h3>
<p>We will look at the built-in <code>cars</code> dataset. Let’s get a view of this by just typing <code>View(cars)</code> in Rstudio. You can see something like this:</p>
<pre><code>#OUT&gt;   speed dist
#OUT&gt; 1     4    2
#OUT&gt; 2     4   10
#OUT&gt; 3     7    4
#OUT&gt; 4     7   22
#OUT&gt; 5     8   16
#OUT&gt; 6     9   10</code></pre>
<p>We have a <code>data.frame</code> with two columns: <code>speed</code> and <code>dist</code>. Type <code>help(cars)</code> to find out more about the dataset. There you could read that</p>
<blockquote>
<p>The data give the speed of cars (mph) and the distances taken to stop (ft).</p>
</blockquote>
<p>It’s good practice to know the extent of a dataset. You could just type</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(cars)</code></pre></div>
<pre><code>#OUT&gt; [1] 50  2</code></pre>
<p>to find out that we have 50 rows and 2 columns. A central question that we want to ask now is the following:</p>
</div>
<div id="how-are-speed-and-dist-related" class="section level3">
<h3><span class="header-section-number">3.1.2</span> How are <code>speed</code> and <code>dist</code> related?</h3>
<p>The simplest way to start is to plot the data. Remembering that we view each row of a data.frame as an observation, we could just label one axis of a graph <code>speed</code>, and the other one <code>dist</code>, and go through our table above row by row. We just have to read off the x/y coordinates and mark them in the graph. In <code>R</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(dist <span class="op">~</span><span class="st"> </span>speed, <span class="dt">data =</span> cars,
     <span class="dt">xlab =</span> <span class="st">&quot;Speed (in Miles Per Hour)&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Stopping Distance (in Feet)&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Stopping Distance vs Speed&quot;</span>,
     <span class="dt">pch  =</span> <span class="dv">20</span>,
     <span class="dt">cex  =</span> <span class="dv">2</span>,
     <span class="dt">col  =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>Here, each dot represents one observation. In this case, one particular measurement <code>speed</code> and <code>dist</code> for a car. Now, again:</p>
<div class="note">
<p>
How are <code>speed</code> and <code>dist</code> related? How could one best <em>summarize</em> this relationship?
</p>
</div>
<p><br> One thing we could do, is draw a straight line through this scatterplot, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(dist <span class="op">~</span><span class="st"> </span>speed, <span class="dt">data =</span> cars,
     <span class="dt">xlab =</span> <span class="st">&quot;Speed (in Miles Per Hour)&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Stopping Distance (in Feet)&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Stopping Distance vs Speed&quot;</span>,
     <span class="dt">pch  =</span> <span class="dv">20</span>,
     <span class="dt">cex  =</span> <span class="dv">2</span>,
     <span class="dt">col  =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a =</span> <span class="dv">60</span>,<span class="dt">b =</span> <span class="dv">0</span>,<span class="dt">lw=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>Now that doesn’t seem a particularly <em>good</em> way to summarize the relationship. Clearly, a <em>better</em> line would be not be flat, but have a <em>slope</em>, i.e. go upwards:</p>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>That is slightly better. However, the line seems at too high a level - the point at which it crosses the y-axis is called the <em>intercept</em>; and it’s too high. We just learned how to represent a <em>line</em>, i.e. with two numbers called <em>intercept</em> and <em>slope</em>. Let’s write down a simple formula which represents a line where some outcome <span class="math inline">\(z\)</span> is related to a variable <span class="math inline">\(x\)</span>:</p>
<span class="math display" id="eq:bline">\[\begin{equation}
z = b_0 + b_1 x \tag{3.1}
\end{equation}\]</span>
<p>Here <span class="math inline">\(b_0\)</span> represents the value of the intercept (i.e. <span class="math inline">\(z\)</span> when <span class="math inline">\(x=0\)</span>), and <span class="math inline">\(b_1\)</span> is the value of the slope. The question for us is now: How to choose the number <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> such that the result is the <strong>good</strong> line?</p>
</div>
<div id="choosing-the-best-line" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Choosing the Best Line</h3>
<p>In order to be able to reason about good or bad line, we need to denote the <em>output</em> of equation <a href="linreg.html#eq:bline">(3.1)</a>. We call the value <span class="math inline">\(\hat{y}_i\)</span> the <em>predicted value</em> for obseration <span class="math inline">\(i\)</span>, after having chosen some particular values <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>:</p>
<span class="math display" id="eq:abline-pred">\[\begin{equation}
\hat{y}_i = b_0 + b_1 x_i \tag{3.2}
\end{equation}\]</span>
<p>In general it is likely that we won’t be able to choose <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> in such as way as to provide a perfect prediction, i.e. one where <span class="math inline">\(\hat{y}_i = y_i\)</span> for all <span class="math inline">\(i\)</span>. That is, we expect to make an <em>error</em> in our prediction <span class="math inline">\(\hat{y}_i\)</span>, so let’s denote this value <span class="math inline">\(e_i\)</span>. If we acknowlegdge that we will make errors, let’s at least make them as small as possible! Exactly this is going to be our task now.</p>
<p>Suppose we have the following set of 9 observations on <code>x</code> and <code>y</code>, and we put the <em>best</em> straight line into it, that we can think of. It would look like this:</p>
<div class="figure" style="text-align: center"><span id="fig:line-arrows"></span>
<img src="ScPoEconometrics_files/figure-html/line-arrows-1.png" alt="The best line and its errors" width="672" />
<p class="caption">
Figure 3.1: The best line and its errors
</p>
</div>
<p>Here, the red arrows indicate the <strong>distance</strong> between the prediction (i.e. the black line) to each data point, in other words, each arrow is a particular <span class="math inline">\(e_i\)</span>. An upward pointing arrow indicates a positive value of a particular <span class="math inline">\(e_i\)</span>, and vice versa for downward pointing arrows. The erros are also called <em>residuals</em>, which comes from the way can write the equation for this relationship between two particular values <span class="math inline">\((y_i,x_i)\)</span> belonging to observation <span class="math inline">\(i\)</span>:</p>
<span class="math display" id="eq:abline">\[\begin{equation}
y_i = b_0 + b_1 x_i + e_i \tag{3.3}
\end{equation}\]</span>
<p>You realize of course that <span class="math inline">\(\hat{y}_i = y_i - e_i\)</span>, which just means that our prediction is the observed value <span class="math inline">\(y_i\)</span> minus any error <span class="math inline">\(e_i\)</span> we make. In other words, <span class="math inline">\(e_i\)</span> is what is left to be explained on top of the line <span class="math inline">\(b_0 + b_1 x_i\)</span>, hence, it’s a residual to explain <span class="math inline">\(y_i\)</span>. Here are <span class="math inline">\(y,\hat{y}\)</span> and the resulting <span class="math inline">\(e\)</span> which are plotted in figure <a href="linreg.html#fig:line-arrows">3.1</a>:</p>
<table>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">y_hat</th>
<th align="center">error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0.00</td>
<td align="center">2.09</td>
<td align="center">2.57</td>
<td align="center">-0.48</td>
</tr>
<tr class="even">
<td align="center">1.25</td>
<td align="center">2.79</td>
<td align="center">3.41</td>
<td align="center">-0.62</td>
</tr>
<tr class="odd">
<td align="center">2.50</td>
<td align="center">6.49</td>
<td align="center">4.25</td>
<td align="center">2.24</td>
</tr>
<tr class="even">
<td align="center">3.75</td>
<td align="center">1.71</td>
<td align="center">5.10</td>
<td align="center">-3.39</td>
</tr>
<tr class="odd">
<td align="center">5.00</td>
<td align="center">9.89</td>
<td align="center">5.94</td>
<td align="center">3.95</td>
</tr>
<tr class="even">
<td align="center">6.25</td>
<td align="center">7.62</td>
<td align="center">6.78</td>
<td align="center">0.83</td>
</tr>
<tr class="odd">
<td align="center">7.50</td>
<td align="center">4.86</td>
<td align="center">7.63</td>
<td align="center">-2.77</td>
</tr>
<tr class="even">
<td align="center">8.75</td>
<td align="center">7.38</td>
<td align="center">8.47</td>
<td align="center">-1.09</td>
</tr>
<tr class="odd">
<td align="center">10.00</td>
<td align="center">10.63</td>
<td align="center">9.31</td>
<td align="center">1.32</td>
</tr>
</tbody>
</table>
<p>If our line was a <strong>perfect fit</strong> to the data, all <span class="math inline">\(e_i = 0\)</span>, and the column <code>error</code> would display <code>0</code> for each row - there would be no errors at all. (All points in figure <a href="linreg.html#fig:line-arrows">3.1</a> would perfectly line up on a straight line).</p>
<p>Now, back to our claim that this particular line is the <em>best</em> line. What exactly characterizes this best line? We now come back to what we said above - <em>how to make the errors as small as possible</em>? Keeping in mind that each residual <span class="math inline">\(e_i\)</span> is <span class="math inline">\(y_i - \hat{y}_i\)</span>, we have the following minization problem to solve:</p>
<span class="math display" id="eq:ols-min">\[\begin{align}
e_i &amp; = y_i - \hat{y}_i = y_i - \underbrace{\left(b_0 + b_1 x_i\right)}_\text{prediction}\\
e_1^2 + \dots + e_N^2 &amp;= \sum_{i=1}^N e_i^2 \equiv \text{SSR}(b_0,b_1) \\
(b_0,b_1) &amp;= \arg \min_{\text{int},\text{slope}} \sum_{i=1}^N \left[y_i - \left(\text{int} + \text{slope } x_i\right)\right]^2 \tag{3.4}
\end{align}\]</span>
<div class="warning">
<p>
The best line chooses <span class="math inline"><span class="math inline">\(b_0\)</span></span> and <span class="math inline"><span class="math inline">\(b_1\)</span></span> so as to minimize the sum of <strong>squared residuals</strong> (SSR).
</p>
</div>
<p><br> Wait a moment, why <em>squared</em> residuals? This is easy to understand: suppose that instead, we wanted to just make the <em>sum</em> of the arrows in figure <a href="linreg.html#fig:line-arrows">3.1</a> as small as possible (that is, no squares). Choosing our line to make this number small would not give a particularly good representation of the data – given that errors of opposite sign and equal magnitude offset, we could have very long arrows (but of opposite signs), and a poor resulting line. Squaring each error avoids this (because now negative errors get positive values!)</p>
<div class="figure" style="text-align: center"><span id="fig:line-squares"></span>
<img src="ScPoEconometrics_files/figure-html/line-squares-1.png" alt="The best line and its SQUARED errors" width="672" />
<p class="caption">
Figure 3.2: The best line and its SQUARED errors
</p>
</div>
<p>We illustrate this in figure <a href="linreg.html#fig:line-squares">3.2</a>. This is the same data as in figure <a href="linreg.html#fig:line-arrows">3.1</a>, but instead of arrows of length <span class="math inline">\(e_i\)</span> for each observation <span class="math inline">\(i\)</span>, now we draw a square with side <span class="math inline">\(e_i\)</span>, i.e. an area of <span class="math inline">\(e_i^2\)</span>. We have two apps for you at this point, one where you have to try and find the best line by choosing <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>, only focusing on the sum of errors (and not their square), and a second one focusing on squared errors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ScPoEconometrics)
<span class="kw">launchApp</span>(<span class="st">&quot;reg_simple_arrows&quot;</span>)
<span class="kw">launchApp</span>(<span class="st">&quot;reg_simple&quot;</span>) <span class="co"># with squared errors</span>
<span class="kw">launchApp</span>(<span class="st">&quot;SSR_cone&quot;</span>) <span class="co"># visualize the minimzation problem from above!</span></code></pre></div>
<p>Most of our <code>apps</code> have an associated <code>about</code> document, which gives extra information and explanations. After you have looked at all three apps, we invite you thus to have a look at the associated explainers by typing</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aboutApp</span>(<span class="st">&quot;reg_simple_arrows&quot;</span>)
<span class="kw">aboutApp</span>(<span class="st">&quot;reg_simple&quot;</span>) 
<span class="kw">aboutApp</span>(<span class="st">&quot;SSR_cone&quot;</span>) </code></pre></div>
</div>
</div>
<div id="OLS" class="section level2">
<h2><span class="header-section-number">3.2</span> Ordinary Least Squares (OLS) Estimator</h2>
<p>The method to compute (or <em>estimate</em>) <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> we illustrated above is called <em>Ordinary Least Squares</em>, or OLS. <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are therefore also often called the <em>OLS coefficients</em>. By solving problem <a href="linreg.html#eq:ols-min">(3.4)</a> one can derive an explicit formula for them:</p>
<span class="math display" id="eq:beta1hat">\[\begin{equation}
b_1 = \frac{cov(x,y)}{var(x)},  \tag{3.5}
\end{equation}\]</span>
<p>i.e. the estimate of the slope coefficient is the covariance between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> divided by the variance of <span class="math inline">\(x\)</span>, both computed from our sample of data. With <span class="math inline">\(b_1\)</span> in hand, we can get the estimate for the intercept as</p>
<span class="math display" id="eq:beta0hat">\[\begin{equation}
b_0 = \bar{y} - b_1 \bar{x}.  \tag{3.6}
\end{equation}\]</span>
<p>where <span class="math inline">\(\bar{z}\)</span> denotes the sample mean of variable <span class="math inline">\(z\)</span>. The interpretation of the OLS slope coefficient <span class="math inline">\(b_1\)</span> is as follows. Given a line as in <span class="math inline">\(y = b_0 + b_1 x\)</span>,</p>
<ul>
<li><span class="math inline">\(b_1 = \frac{d y}{d x}\)</span> measures the change in <span class="math inline">\(y\)</span> resulting from a one unit change in <span class="math inline">\(x\)</span></li>
<li>For example, if <span class="math inline">\(y\)</span> is wage and <span class="math inline">\(x\)</span> is years of education, <span class="math inline">\(b_1\)</span> would measure the effect of an additional year of education on wages.</li>
</ul>
<div id="linear-regression-without-regressor" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Linear Regression without Regressor</h3>
<p>There are several important special cases for the linear regression introduced above. Let’s start with the most obvious one: What is the meaning of running a regression <em>without any regressor</em>, i.e. without a <span class="math inline">\(x\)</span>? Our line becomes very simple. Instead of <a href="linreg.html#eq:bline">(3.1)</a>, we get</p>
<span class="math display" id="eq:b0line">\[\begin{equation}
y = b_0. \tag{3.7}
\end{equation}\]</span>
<p>This means that our minization problem in <a href="linreg.html#eq:ols-min">(3.4)</a> <em>also</em> becomes very simple: We only have to choose <span class="math inline">\(b_0\)</span>! We have</p>
<p><span class="math display">\[
b_0 = \arg\min_{\text{int}} \sum_{i=1}^N \left[y_i - \text{int}\right]^2,
\]</span> which is a quadratic equation with a unique optimum such that <span class="math display">\[
b_0 = \frac{1}{N} \sum_{i=1}^N y_i = \overline{y}.
\]</span></p>
<div class="tip">
<p>
Least Squares <strong>without regressor</strong> <span class="math inline"><span class="math inline">\(x\)</span></span> estimates the sample mean of the outcome variable <span class="math inline"><span class="math inline">\(y\)</span></span>, i.e. it produces <span class="math inline"><span class="math inline">\(\overline{y}\)</span></span>.
</p>
</div>
</div>
<div id="regression-without-an-intercept" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Regression without an Intercept</h3>
<p>We follow the same logic here, just that we miss another bit from our initial equation and the minimisation problem in <a href="linreg.html#eq:ols-min">(3.4)</a> now becomes:</p>
<span class="math display" id="eq:b1line">\[\begin{align}
b_1 &amp;= \arg\min_{\text{slope}} \sum_{i=1}^N \left[y_i - \text{slope } x_i \right]^2\\
\mapsto b_1 &amp;= \frac{\frac{1}{N}\sum_{i=1}^N x_i y_i}{\frac{1}{N}\sum_{i=1}^N x_i^2} = \frac{\bar{x} \bar{y}}{\overline{x^2}} \tag{3.8}
\end{align}\]</span>
<div class="tip">
<p>
Least Squares <strong>without intercept</strong> (i.e. with <span class="math inline"><span class="math inline">\(b_0=0\)</span></span>) is a line that passes through the origin.
</p>
</div>
<p><br></p>
<p>In this case we only get to choose the slope <span class="math inline">\(b_1\)</span> of this anchored line.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> You should now try out both of those restrictions on our linear model by spending some time with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">launchApp</span>(<span class="st">&quot;reg_constrained&quot;</span>)</code></pre></div>
</div>
<div id="centering-a-regression" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Centering A Regression</h3>
<p>By <em>centering</em> or <em>demeaning</em> a regression, we mean to substract from both <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> their respective averages to obtain <span class="math inline">\(\tilde{y}_i = y_i - \bar{y}\)</span> and <span class="math inline">\(\tilde{x}_i = x_i - \bar{x}\)</span>. We then run a regression <em>without intercept</em> as above. That is, we use <span class="math inline">\(\tilde{x}_i,\tilde{y}_i\)</span> instead of <span class="math inline">\(x_i,y_i\)</span> in <a href="linreg.html#eq:b1line">(3.8)</a> to obtain our slope estimate <span class="math inline">\(b_1\)</span>:</p>
<span class="math display" id="eq:bline-centered">\[\begin{align}
b_1 &amp;= \frac{\frac{1}{N}\sum_{i=1}^N \tilde{x}_i \tilde{y}_i}{\frac{1}{N}\sum_{i=1}^N \tilde{x}_i^2}\\
    &amp;= \frac{\frac{1}{N}\sum_{i=1}^N (x_i - \bar{x}) (y_i - \bar{y})}{\frac{1}{N}\sum_{i=1}^N (x_i - \bar{x})^2} \\
    &amp;= \frac{cov(x,y)}{var(x)}
    \tag{3.9}
\end{align}\]</span>
<p>This last expression is <em>identical</em> to the one in <a href="linreg.html#eq:beta1hat">(3.5)</a>! It’s the standard OLS estimate for the slope coefficient. We note the following:</p>
<div class="tip">
<p>
Adding a constant to a regression produces the same result as centering all variables and estimating without intercept. So, unless all variables are centered, <strong>always</strong> include an intercept in the regression.
</p>
</div>
<p><br> To get a better feel for what is going on here, you can try this out now by yourself by typing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">launchApp</span>(<span class="st">&quot;demeaned_reg&quot;</span>)</code></pre></div>
</div>
<div id="standardizing-a-regression" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Standardizing A Regression</h3>
<p><em>Standardizing</em> a variable <span class="math inline">\(z\)</span> means to demean as above, but in addition to divide the demeaned value by its own standard deviation. Similarly to what we did above for <em>centering</em>, we define transformed variables <span class="math inline">\(\breve{y}_i = \frac{y_i-\bar{y}}{\sigma_y}\)</span> and <span class="math inline">\(\breve{x}_i = \frac{x_i-\bar{x}}{\sigma_x}\)</span> where <span class="math inline">\(\sigma_z\)</span> is the standard deviation of variable <span class="math inline">\(z\)</span>. From here on, you should by now be used to what comes next! As above, we use <span class="math inline">\(\breve{x}_i,\breve{y}_i\)</span> instead of <span class="math inline">\(x_i,y_i\)</span> in <a href="linreg.html#eq:b1line">(3.8)</a> to this time obtain:</p>
<span class="math display" id="eq:bline-standardized">\[\begin{align}
b_1 &amp;= \frac{\frac{1}{N}\sum_{i=1}^N \breve{x}_i \breve{y}_i}{\frac{1}{N}\sum_{i=1}^N \breve{x}_i^2}\\
    &amp;= \frac{\frac{1}{N}\sum_{i=1}^N \frac{x_i - \bar{x}}{\sigma_x} \frac{y_i - \bar{y}}{\sigma_y}}{\frac{1}{N}\sum_{i=1}^N \left(\frac{x_i - \bar{x}}{\sigma_x}\right)^2} \\
    &amp;= \frac{Cov(x,y)}{\sigma_x \sigma_y} \\
    &amp;= Corr(x,y)  \tag{3.10}
\end{align}\]</span>
<div class="tip">
<p>
After we standardize both <span class="math inline"><span class="math inline">\(y\)</span></span> and <span class="math inline"><span class="math inline">\(x\)</span></span>, the slope coefficient <span class="math inline"><span class="math inline">\(b_1\)</span></span> in the regression without intercept is equal to the <strong>correlation coefficient</strong>.
</p>
</div>
<p><br> And also for this case we have a practical application for you. Just type this and play around with the app for a little while!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">launchApp</span>(<span class="st">&quot;reg_standardized&quot;</span>)</code></pre></div>
</div>
</div>
<div id="pred-resids" class="section level2">
<h2><span class="header-section-number">3.3</span> Predictions and Residuals</h2>
<p>Now we want to ask how our residuals <span class="math inline">\(e_i\)</span> relate to the prediction <span class="math inline">\(\hat{y_i}\)</span>. Let us first think about the average of all predictions <span class="math inline">\(\hat{y_i}\)</span>, i.e. the number <span class="math inline">\(\frac{1}{N} \sum_{i=1}^N \hat{y_i}\)</span>. Let’s just take <a href="linreg.html#eq:abline-pred">(3.2)</a> and plug this into this average, so that we get</p>
<span class="math display">\[\begin{align}
\frac{1}{N} \sum_{i=1}^N \hat{y_i} &amp;= \frac{1}{N} \sum_{i=1}^N b_0 + b_1 x_i \\
&amp;= b_0 + b_1  \frac{1}{N} \sum_{i=1}^N x_i \\
&amp;= b_0 + b_1  \bar{x} \\
\end{align}\]</span>
<p>But that last line is just equal to the formula for the OLS intercept <a href="linreg.html#eq:beta0hat">(3.6)</a>, <span class="math inline">\(b_0 = \bar{y} - b_1 \bar{x}\)</span>! That means of course that</p>
<p><span class="math display">\[
\frac{1}{N} \sum_{i=1}^N \hat{y_i}  = b_0 + b_1  \bar{x} = \bar{y}
\]</span> in other words:</p>
<div class="tip">
<p>
The average of our predictions <span class="math inline"><span class="math inline">\(\hat{y_i}\)</span></span> is identically equal to the mean of the outcome <span class="math inline"><span class="math inline">\(y\)</span></span>. This implies that the average of the residuals is equal to zero.
</p>
</div>
<p><br> Related to this result, we can show that the prediction <span class="math inline">\(\hat{y}\)</span> and the residuals are <em>uncorrelated</em>, something that is often called <strong>orthogonality</strong> between <span class="math inline">\(\hat{y}_i\)</span> and <span class="math inline">\(e_i\)</span>. We would write this as</p>
<span class="math display">\[\begin{align}
Cov(\hat{y},e) &amp;=\frac{1}{N} \sum_{i=1}^N (\hat{y}_i-\bar{y})(e_i-\bar{e}) =   \frac{1}{N} \sum_{i=1}^N (\hat{y}_i-\bar{y})e_i \\
&amp;=  \frac{1}{N} \sum_{i=1}^N \hat{y}_i e_i-\bar{y} \frac{1}{N} \sum_{i=1}^N e_i = 0
\end{align}\]</span>
<p>It’s useful to bring back the sample data which generate figure <a href="linreg.html#fig:line-arrows">3.1</a> at this point in order to verify these claims:</p>
<pre><code>#OUT&gt;       y y_hat error
#OUT&gt; 1  2.09  2.57 -0.48
#OUT&gt; 2  2.79  3.41 -0.62
#OUT&gt; 3  6.49  4.25  2.24
#OUT&gt; 4  1.71  5.10 -3.39
#OUT&gt; 5  9.89  5.94  3.95
#OUT&gt; 6  7.62  6.78  0.83
#OUT&gt; 7  4.86  7.63 -2.77
#OUT&gt; 8  7.38  8.47 -1.09
#OUT&gt; 9 10.63  9.31  1.32</code></pre>
<p>Let’s check that these claims are true in this sample of data. We want that</p>
<ol style="list-style-type: decimal">
<li>The average of <span class="math inline">\(\hat{y}_i\)</span> to be the same as the mean of <span class="math inline">\(y\)</span></li>
<li>The average of the errors should be zero.</li>
<li>Prediction and errors should be uncorrelated.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1.</span>
<span class="kw">all.equal</span>(<span class="kw">mean</span>(ss<span class="op">$</span>error), <span class="dv">0</span>)</code></pre></div>
<pre><code>#OUT&gt; [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2.</span>
<span class="kw">all.equal</span>(<span class="kw">mean</span>(ss<span class="op">$</span>y_hat), <span class="kw">mean</span>(ss<span class="op">$</span>y))</code></pre></div>
<pre><code>#OUT&gt; [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 3.</span>
<span class="kw">all.equal</span>(<span class="kw">cov</span>(ss<span class="op">$</span>error,ss<span class="op">$</span>y_hat), <span class="dv">0</span>)</code></pre></div>
<pre><code>#OUT&gt; [1] TRUE</code></pre>
<p>So indeed we can confirm this result with our test dataset. Great!</p>
</div>
<div id="correlation-covariance-and-linearity" class="section level2">
<h2><span class="header-section-number">3.4</span> Correlation, Covariance and Linearity</h2>
<p>It is important to keep in mind that Correlation and Covariance relate to a <em>linear</em> relationship between <code>x</code> and <code>y</code>. Given how the regression line is estimated by OLS (see just above), you can see that the regression line inherits this property from the Covariance. A famous exercise by Francis Anscombe (1973) illustrates this by constructing 4 different datasets which all have identical <strong>linear</strong> statistics: mean, variance, correlation and regression line <em>are identical</em>. However, the usefulness of the statistics to describe the relationship in the data is not clear.</p>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p>The important lesson from this example is the following:</p>
<div class="warning">
<p>
Always <strong>visually inspect</strong> your data, and don’t rely exclusively on summary statistics like <em>mean, variance, correlation and regression line</em>. All of those assume a <strong>linear</strong> relationship between the variables in your data.
</p>
</div>
<p><br> The mission of Anscombe has been continued recently. As a result of this we can have a look at the <code>datasauRus</code> package, which pursues Anscbombe’s idea through a multitude of funny data sets, all with the same linear statistics. Don’t just compute the covariance, or you might actually end up looking at a Dinosaur! What? Type this to find out:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">launchApp</span>(<span class="st">&quot;datasaurus&quot;</span>)
<span class="kw">aboutApp</span>(<span class="st">&quot;datasaurus&quot;</span>)</code></pre></div>
<div id="non-linear-relationships-in-data" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Non-Linear Relationships in Data</h3>
<p>Suppose our data now looks like this:</p>
<p><img src="ScPoEconometrics_files/figure-html/non-line-cars-1.png" width="672" /></p>
<p>Putting our previous <em>best line</em> defined in equation <a href="linreg.html#eq:abline">(3.3)</a> as <span class="math inline">\(y = b_0 + b_1 x + e\)</span>, we get something like this:</p>
<div class="figure" style="text-align: center"><span id="fig:non-line-cars-ols"></span>
<img src="ScPoEconometrics_files/figure-html/non-line-cars-ols-1.png" alt="Best line with non-linear data?" width="672" />
<p class="caption">
Figure 3.3: Best line with non-linear data?
</p>
</div>
<p>Somehow when looking at <a href="linreg.html#fig:non-line-cars-ols">3.3</a> one is not totally convinced that the straight line is a good summary of this relationship. For values <span class="math inline">\(x\in[50,120]\)</span> the line seems to low, then again too high, and it completely misses the right boundary. It’s easy to address this shortcoming by including <em>higher order terms</em> of an explanatory variable. We would modify <a href="linreg.html#eq:abline">(3.3)</a> to read now</p>
<span class="math display" id="eq:abline2">\[\begin{equation}
y_i = b_0 + b_1 x_i + b_2 x_i^2 + e_i \tag{3.11}
\end{equation}\]</span>
<p>This is a special case of <em>multiple regression</em>, which we will talk about in chapter <a href="multiple-reg.html#multiple-reg">4</a>. You can see that there are <em>multiple</em> slope coefficients. For now, let’s just see how this performs:</p>
<div class="figure" style="text-align: center"><span id="fig:non-line-cars-ols2"></span>
<img src="ScPoEconometrics_files/figure-html/non-line-cars-ols2-1.png" alt="Better line with non-linear data!" width="672" />
<p class="caption">
Figure 3.4: Better line with non-linear data!
</p>
</div>
</div>
</div>
<div id="analysing-vary" class="section level2">
<h2><span class="header-section-number">3.5</span> Analysing <span class="math inline">\(Var(y)\)</span></h2>
<p>Analysis of Variance (ANOVA) refers to a method to decompose variation in one variable as a function of several others. We can use this idea on our outcome <span class="math inline">\(y\)</span>. Suppose we wanted to know the variance of <span class="math inline">\(y\)</span>, keeping in mind that, by definition, <span class="math inline">\(y_i = \hat{y}_i + e_i\)</span>. We would write</p>
<span class="math display" id="eq:anova">\[\begin{align}
Var(y) &amp;= Var(\hat{y} + e)\\
 &amp;= Var(\hat{y}) + Var(e) + 2 Cov(\hat{y},e)\\
 &amp;= Var(\hat{y}) + Var(e) \tag{3.12}
\end{align}\]</span>
<p>We have seen above in <a href="linreg.html#pred-resids">3.3</a> that the covariance between prediction <span class="math inline">\(\hat{y}\)</span> and error <span class="math inline">\(e\)</span> is zero, that’s why we have <span class="math inline">\(Cov(\hat{y},e)=0\)</span> in <a href="linreg.html#eq:anova">(3.12)</a>. What this tells us in words is that we can decompose the variance in the observed outcome <span class="math inline">\(y\)</span> into a part that relates to variance as <em>explained by the model</em> and a part that comes from unexplained variation. Finally, we know the definition of <em>variance</em>, and can thus write down the respective formulae for each part:</p>
<ul>
<li><span class="math inline">\(Var(y) = \frac{1}{N}\sum_{i=1}^N (y_i - \bar{y})^2\)</span></li>
<li><span class="math inline">\(Var(\hat{y}) = \frac{1}{N}\sum_{i=1}^N (\hat{y_i} - \bar{y})^2\)</span>, because the mean of <span class="math inline">\(\hat{y}\)</span> is <span class="math inline">\(\bar{y}\)</span> as we know. Finally,</li>
<li><span class="math inline">\(Var(e) = \frac{1}{N}\sum_{i=1}^N e_i^2\)</span>, because the mean of <span class="math inline">\(e\)</span> is zero.</li>
</ul>
<p>We can thus formulate how the total variation in outcome <span class="math inline">\(y\)</span> is aportioned between model and unexplained variation:</p>
<div class="tip">
<p>
The total variation in outcome <span class="math inline"><span class="math inline">\(y\)</span></span> (often called SST, or <em>total sum of squares</em>) is equal to the sum of explained squares (SSE) plus the sum of residuals (SSR). We have thus <strong>SST = SSE + SSR</strong>.
</p>
</div>
</div>
<div id="assessing-the-goodness-of-fit" class="section level2">
<h2><span class="header-section-number">3.6</span> Assessing the <em>Goodness of Fit</em></h2>
<p>In our setup, there exists a convenient measure for how good a particular statistical model fits the data. It is called <span class="math inline">\(R^2\)</span> (<em>R squared</em>), also called the <em>coefficient of determination</em>. We make use of the just introduced decomposition of variance, and write the formula as</p>
<span class="math display" id="eq:Rsquared">\[\begin{equation}R^2 = \frac{\text{variance explained}}{\text{total variance}} = \frac{SSE}{SST} = 1 - \frac{SS\tag{3.13}]  (#eq:Rsquared)
\end{equation}\]</span>
<p>It is easy to see that a <em>good fit</em> is one where the sum of <em>explained</em> squares (SSE) is large relativ to the total variation (SST). In such a case, we observe an <span class="math inline">\(R^2\)</span> close to one. In the opposite case, we will see an <span class="math inline">\(R^2\)</span> close to zero. Notice that a small <span class="math inline">\(R^2\)</span> does not imply that the model is useless, just that it explains a small fraction of the observed variation.</p>
</div>
<div id="lm-example1" class="section level2">
<h2><span class="header-section-number">3.7</span> An Example: California Student Test Scores</h2>
<p>Luckily for us, fitting a linear model to some data does not require us to iteratively find the best intercept and slope manually, as you have experienced in our <code>apps</code>. As it turns out, <code>R</code> can do this much more precisely, and very fast!</p>
<p>Let’s explore how to do this, using a real life dataset taken from the <code>Ecdat</code> package which includes many economics-related dataset. In this example, we will use the <code>Caschool</code> dataset which contains the average test scores of 420 elementary schools in California along with some additional information.</p>
<div id="loading-and-exploring-data" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Loading and exploring Data</h3>
<p>We can explore which variables are included in the dataset using the <code>names()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;Ecdat&quot;</span>) <span class="co"># Load the Ecdat library</span>
<span class="kw">names</span>(Caschool) <span class="co"># Display the variables of the Caschool dataset</span></code></pre></div>
<pre><code>#OUT&gt;  [1] &quot;distcod&quot;  &quot;county&quot;   &quot;district&quot; &quot;grspan&quot;   &quot;enrltot&quot;  &quot;teachers&quot;
#OUT&gt;  [7] &quot;calwpct&quot;  &quot;mealpct&quot;  &quot;computer&quot; &quot;testscr&quot;  &quot;compstu&quot;  &quot;expnstu&quot; 
#OUT&gt; [13] &quot;str&quot;      &quot;avginc&quot;   &quot;elpct&quot;    &quot;readscr&quot;  &quot;mathscr&quot;</code></pre>
<p>For each variable in the dataset, basic summary statistics can be obtained by calling <code>summary()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(Caschool[, <span class="kw">c</span>(<span class="st">&quot;testscr&quot;</span>, <span class="st">&quot;str&quot;</span>, <span class="st">&quot;avginc&quot;</span>)])</code></pre></div>
<pre><code>#OUT&gt;     testscr           str            avginc      
#OUT&gt;  Min.   :605.5   Min.   :14.00   Min.   : 5.335  
#OUT&gt;  1st Qu.:640.0   1st Qu.:18.58   1st Qu.:10.639  
#OUT&gt;  Median :654.5   Median :19.72   Median :13.728  
#OUT&gt;  Mean   :654.2   Mean   :19.64   Mean   :15.317  
#OUT&gt;  3rd Qu.:666.7   3rd Qu.:20.87   3rd Qu.:17.629  
#OUT&gt;  Max.   :706.8   Max.   :25.80   Max.   :55.328</code></pre>
</div>
<div id="fitting-a-linear-model" class="section level3">
<h3><span class="header-section-number">3.7.2</span> Fitting a linear model</h3>
<p>Suppose we are interested in the following linear model:</p>
<p><span class="math display">\[\text{testscr}_i = b_0 + b_1 \times \text{str}_i + e_i\]</span> Where <span class="math inline">\(\text{testscr}_i\)</span> is the <em>average test score</em> for a given school <span class="math inline">\(i\)</span> and <span class="math inline">\(\text{str}_i\)</span> is the <em>Student/Teacher Ratio</em> (i.e. the average number of students per teacher) in the same school <span class="math inline">\(i\)</span>. Again, <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are the intercept and the slope of the regression line.</p>
<p>The subscript <span class="math inline">\(i\)</span> indexes all unique elementary schools (<span class="math inline">\(i \in \{1, 2, 3, \dots 420\}\)</span>) and <span class="math inline">\(e_i\)</span> is the error, or <em>residual</em>, of the regression. (Remember that our procedure for finding the line of best fit is to minimize the <em>sum of squared residuals</em> (SSR)).</p>
<p>At this point you should step back and take a second to think about what you believe the relation between a school’s test scores and student/teacher ratio will be. Do you believe that, in general, a high student/teacher ratio will be associated with higher-than-average test scores for the school? Do you think that the number of students per teacher will impact results in any way?</p>
<p>Let’s find out! As always, we will start by plotting the data to inspect it visually:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str,
     <span class="dt">data =</span> Caschool,
     <span class="dt">xlab =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Average Test Score&quot;</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:first-reg0"></span>
<img src="ScPoEconometrics_files/figure-html/first-reg0-1.png" alt="Student Teacher Ratio vs Test Scores" width="672" />
<p class="caption">
Figure 3.5: Student Teacher Ratio vs Test Scores
</p>
</div>
<p>Can you spot a trend in the data? According to you, what would the line of best fit look like? Would it be upward or downward slopping? Let’s ask <code>R</code>!</p>
</div>
<div id="the-lm-function" class="section level3">
<h3><span class="header-section-number">3.7.3</span> The <code>lm()</code> function</h3>
<p>We will use the built-in <code>lm()</code> function to estimate the coefficients <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> using the data at hand. <code>lm</code> stands for <em>linear model</em>, which is what our representation in <a href="linreg.html#eq:abline">(3.3)</a> amounts to. This function typically only takes 2 arguments, <code>formula</code> and <code>data</code>:</p>
<p><code>lm(formula, data)</code></p>
<ul>
<li><p><code>formula</code> is the description of our model which we want <code>R</code> to estimate for us. Its syntax is very simple: <code>Y ~ X</code> (more generally, <code>DependentVariable ~ Independent Variables</code>). You can think of the tilda operator <code>~</code> as the equal sign in your model equation. An intercept is included by default and so you do not have to ask for it in <code>formula</code>. For example, the simple model <span class="math inline">\(income = b_0 + b_1 \cdot age\)</span> can be written as <code>income ~ age</code>. A <code>formula</code> can sometimes be written between quotation marks: <code>&quot;X ~ Y&quot;</code>.</p></li>
<li><p><code>data</code> is simply the <code>data.frame</code> containing the variables in the model.</p></li>
</ul>
<p>In the context of our example, the function call is therefore:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assign lm() output to some object `fit_cal`</span>
fit_cal &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str, <span class="dt">data =</span> Caschool)

<span class="co"># ask R for the regression summary</span>
<span class="kw">summary</span>(fit_cal) </code></pre></div>
<pre><code>#OUT&gt; 
#OUT&gt; Call:
#OUT&gt; lm(formula = testscr ~ str, data = Caschool)
#OUT&gt; 
#OUT&gt; Residuals:
#OUT&gt;     Min      1Q  Median      3Q     Max 
#OUT&gt; -47.727 -14.251   0.483  12.822  48.540 
#OUT&gt; 
#OUT&gt; Coefficients:
#OUT&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#OUT&gt; (Intercept) 698.9330     9.4675  73.825  &lt; 2e-16 ***
#OUT&gt; str          -2.2798     0.4798  -4.751 2.78e-06 ***
#OUT&gt; ---
#OUT&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
#OUT&gt; 
#OUT&gt; Residual standard error: 18.58 on 418 degrees of freedom
#OUT&gt; Multiple R-squared:  0.05124, Adjusted R-squared:  0.04897 
#OUT&gt; F-statistic: 22.58 on 1 and 418 DF,  p-value: 2.783e-06</code></pre>
<p>As we can see, <code>R</code> returns its estimates for the Intercept and Slope coefficients, <span class="math inline">\(b_0 =\)</span> 698.93 and <span class="math inline">\(b_1 =\)</span> -2.28. The estimated relationship between a school’s Student/Teacher Ratio and its average test results is <strong>negative</strong>.</p>
<p>The output of the <code>summary</code> method for an <code>lm</code> object is commonly called a <em>regression table</em>, and you will be able to decypher it by the end of this course. You should be able to find an interpret the <span class="math inline">\(R^2\)</span> though: Are we explaining a lot of the variance in <code>testscr</code> with this simple model, or are we not?</p>
</div>
<div id="plotting-the-regression-line" class="section level3">
<h3><span class="header-section-number">3.7.4</span> Plotting the regression line</h3>
<p>We can also use our <code>lm</code> fit to draw the regression line on top of our initial scatterplot, using the following syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str,
     <span class="dt">data =</span> Caschool,
     <span class="dt">xlab =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Average Test Score&quot;</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)<span class="co"># same plot as before</span>
<span class="kw">abline</span>(fit_cal, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co"># add regression line</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plot-reg1"></span>
<img src="ScPoEconometrics_files/figure-html/plot-reg1-1.png" alt="Test Scores with Regression Line" width="672" />
<p class="caption">
Figure 3.6: Test Scores with Regression Line
</p>
</div>
<p>As you probably expected, the best line for schools’ Student/Teacher Ratio and its average test results is downward sloping.</p>
<p>Just as a way of showcasing another way to make the above plot, here is how you could use <code>ggplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> str, <span class="dt">y =</span> testscr), <span class="dt">data =</span> Caschool) <span class="co"># base plot</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="co"># add points</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="co"># add regression line</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Average Test Score&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">         </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>)
p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Testscores vs Student/Teacher Ratio&quot;</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-133-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The shaded area around the red line shows the width of the 95% confidence interval around our estimate of the slope coefficient <span class="math inline">\(b_1\)</span>. We will learn more about it in chapter <a href="std-errors.html#std-errors">6</a>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>This slope is related to the angle between vectors <span class="math inline">\(\mathbf{a} = (\overline{x},\overline{y})\)</span>, and <span class="math inline">\(\mathbf{b} = (\overline{x},0)\)</span>. Hence, it’s related to the <a href="https://en.wikipedia.org/wiki/Scalar_projection">scalar projection</a> of <span class="math inline">\(\mathbf{a}\)</span> on <span class="math inline">\(\mathbf{b}\)</span>.<a href="linreg.html#fnref3">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sum.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-reg.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ScPoEcon/ScPoEconometrics/edit/master/03-linear-reg.Rmd",
"text": "Edit"
},
"download": ["ScPoEconometrics.pdf", "ScPoEconometrics.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
